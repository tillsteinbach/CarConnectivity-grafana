{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "datasource",
          "uid": "grafana"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "limit": 100,
        "name": "Annotations & Alerts",
        "showIn": 0,
        "target": {
          "limit": 100,
          "matchAny": false,
          "tags": [],
          "type": "dashboard"
        },
        "type": "dashboard"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "CarConnectivity-PostgreSQL-provisioned"
        },
        "enable": false,
        "hide": false,
        "iconColor": "#73BF69",
        "name": "Online",
        "showIn": 0,
        "target": {
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \"time\",\n       \"timeend\",\n       'Online' AS \"title\",\n       'Online ('\n              || (\"timeend\"-\"time\")\n              || ')' AS \"text\",\n       \"id\"\nFROM   (\n                SELECT   *,\n                         \"first_date\"                                           AS \"time\",\n                         Lag(\"connection_state\") OVER (ORDER BY \"first_date\") AS \"before_connection_state\",\n                         (\n                                  SELECT   \"first_date\" AS \"timeend\"\n                                  FROM     connection_states          AS connection_states2\n                                  WHERE    connection_states2.\"connection_state\" != 'ONLINE'\n                                  AND      connection_states.vin = connection_states2.vin\n                                  AND      connection_states.\"first_date\" < connection_states2.\"first_date\"\n                                  ORDER BY \"first_date\" limit 1) \"timeend\"\n                FROM     connection_states\n                WHERE    vin = '$VIN') AS data\nWHERE  \"connection_state\" = 'ONLINE'\nAND (\"timeend\"-\"time\") < INTERVAL '12 hour'\nAND    \"before_connection_state\" != 'ONLINE'\nAND ($__timeFilter(\"time\") OR $__timeFilter(\"timeend\"))",
          "refId": "Annotation",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "CarConnectivity-PostgreSQL-provisioned"
        },
        "enable": false,
        "hide": false,
        "iconColor": "red",
        "name": "Climatization",
        "target": {
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \"time\",\n       \"timeend\",\n       'Climatization' AS \"title\",\n       'Climatization on ('\n              || (\"timeend\"-\"time\")\n              || ')' AS \"text\",\n       \"id\"\nFROM   (\n                SELECT   *,\n                         \"first_date\"                                           AS \"time\",\n                         Lag(\"state\") OVER (ORDER BY \"first_date\") AS \"before_climatization_state\",\n                         (\n                                  SELECT   \"first_date\" AS \"timeend\"\n                                  FROM     climatization_states          AS climatization_states2\n                                  WHERE    climatization_states2.\"state\" = 'OFF'\n                                  AND      climatization_states.vin = climatization_states2.vin\n                                  AND      climatization_states.\"first_date\" < climatization_states2.\"first_date\"\n                                  ORDER BY \"first_date\" limit 1) \"timeend\"\n                FROM     climatization_states\n                WHERE    vin = '$VIN') AS data\nWHERE  \"state\" != 'OFF'\nAND (\"timeend\"-\"time\") < INTERVAL '2 hour'\nAND    \"before_climatization_state\" = 'OFF'\nAND ($__timeFilter(\"time\") OR $__timeFilter(\"timeend\"))",
          "refId": "Annotation",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "CarConnectivity-PostgreSQL-provisioned"
        },
        "enable": false,
        "hide": false,
        "iconColor": "blue",
        "name": "Charging",
        "target": {
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \"time\",\n       \"timeend\",\n       'Charging' AS \"title\",\n       'Charging ('\n              || (\"timeend\"-\"time\")\n              || ')' AS \"text\",\n       \"id\"\nFROM   (\n                SELECT   *,\n                         \"first_date\"                                           AS \"time\",\n                         Lag(\"state\") OVER (ORDER BY \"first_date\") AS \"before_charging_state\",\n                         (\n                                  SELECT   \"first_date\" AS \"timeend\"\n                                  FROM     charging_states        AS charging_states2\n                                  WHERE    charging_states2.\"state\" NOT IN ('CHARGING', 'CONSERVATION')\n                                  AND      charging_states.vin = charging_states2.vin\n                                  AND      charging_states.\"first_date\" < charging_states2.\"first_date\"\n                                  ORDER BY \"first_date\" limit 1) \"timeend\"\n                FROM     charging_states \n                WHERE    vin = '${VIN}'\n                ) AS data\nWHERE  \"state\" IN ('CHARGING', 'CONSERVATION')\nAND (\"timeend\"-\"time\") < INTERVAL '1 day'\nAND    \"before_charging_state\" NOT IN ('CHARGING', 'CONSERVATION')\nAND ($__timeFilter(\"time\") OR $__timeFilter(\"timeend\"))",
          "refId": "Annotation",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      },
      {
        "datasource": {
          "type": "grafana-postgresql-datasource",
          "uid": "CarConnectivity-PostgreSQL-provisioned"
        },
        "enable": false,
        "hide": false,
        "iconColor": "purple",
        "name": "Driving",
        "target": {
          "dataset": "carconnectivity",
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \"time\",\n       \"timeend\",\n       'Driving' AS \"title\",\n       'Driving ('\n              || (\"timeend\"-\"time\")\n              || ')' AS \"text\",\n       \"id\"\nFROM   (\n                SELECT   *,\n                         \"first_date\"                                           AS \"time\",\n                         Lag(\"state\") OVER (ORDER BY \"first_date\") AS \"before_state\",\n                         (\n                                  SELECT   \"first_date\" AS \"timeend\"\n                                  FROM     states          AS states2\n                                  WHERE    states2.\"state\" NOT IN ('IGNITION_ON', 'DRIVING')\n                                  AND      states.vin = states2.vin\n                                  AND      states.\"first_date\" < states2.\"first_date\"\n                                  ORDER BY \"first_date\" limit 1) \"timeend\"\n                FROM     states\n                WHERE    vin = '$VIN') AS data\nWHERE  \"state\" IN ('IGNITION_ON', 'DRIVING')\nAND (\"timeend\"-\"time\") < INTERVAL '12 hour'\nAND    \"before_state\" NOT IN ('IGNITION_ON', 'DRIVING')\nAND ($__timeFilter(\"time\") OR $__timeFilter(\"timeend\"))",
          "refId": "Anno",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": 10,
  "links": [
    {
      "asDropdown": false,
      "icon": "external link",
      "includeVars": false,
      "keepTime": false,
      "tags": [],
      "targetBlank": true,
      "title": "Car settings",
      "tooltip": "",
      "type": "link",
      "url": "${carconnectivity_url:raw}/settings/vehicle/database/${VIN}"
    },
    {
      "asDropdown": true,
      "icon": "dashboard",
      "includeVars": true,
      "keepTime": false,
      "tags": [
        "carconnectivity"
      ],
      "targetBlank": false,
      "title": "Dashboards",
      "tooltip": "",
      "type": "dashboards",
      "url": ""
    }
  ],
  "liveNow": true,
  "panels": [
    {
      "datasource": {
        "type": "yesoreyeram-infinity-datasource",
        "uid": "CarConnectivity-live-json-provisioned"
      },
      "description": "Current status of the car ${VIN:text} with VIN ${VIN:raw}. To receive reasonable results you have to make settings for your car.",
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 3,
        "x": 0,
        "y": 0
      },
      "id": 5,
      "links": [
        {
          "targetBlank": true,
          "title": "Car Settings",
          "url": "${carconnectivity_url:raw}/settings/vehicle/database/${VIN}"
        }
      ],
      "options": {
        "SVGBaseFix": true,
        "add100Percentage": false,
        "calcsMutation": "standard",
        "centerAlignContent": true,
        "codeData": "{\n  \"text\": \"Random text\"\n}",
        "css": "",
        "dynamicData": false,
        "dynamicFieldDisplayValues": false,
        "dynamicHtmlGraphics": true,
        "dynamicProps": false,
        "html": "<a id='carlink' target=”_blank”>\n<img src=\"\" id='carimage' style='max-height: 100%; max-width: 100%'/>\n</a>",
        "onInit": "// Sets the text from customProperties\nconst htmlgraphicsText = htmlNode.getElementById('htmlgraphics-text');\n\nif (htmlgraphicsText) {\n  htmlgraphicsText.textContent = customProperties.text;\n\n  // Change the text color based on the theme\n  if (theme.isDark) {\n    htmlgraphicsText.style.color = 'green';\n  } else {\n    htmlgraphicsText.style.color = 'red';\n  }\n}\n",
        "onInitOnResize": false,
        "onRender": "const vin = getTemplateSrv().replace(`$VIN`);\nconst carconnectivity_url = getTemplateSrv().replace(`$carconnectivity_url`);\nconst carimage = htmlNode.querySelector('#carimage');\nconst carlink = htmlNode.querySelector('#carlink');\n\nconst filteredSeriesImage = data.series.filter((series) => series.name == 'A');\njsonImage = null;\nif(filteredSeriesImage.length > 0 && filteredSeriesImage[0].fields != null && filteredSeriesImage[0].fields.length > 2){\n  carimage.src = \"data:\"+filteredSeriesImage[0].fields[2].values.get(0)+\";\"+filteredSeriesImage[0].fields[1].values.get(0)+\",\"+filteredSeriesImage[0].fields[0].values.get(0)\n}\nelse {\n  carimage.src = carconnectivity_url+'/garage/'+vin+'-car.png?fallback=icons/vehicle.png';\n}\n\n\ncarlink.href = carconnectivity_url+'/garage/'+vin+'/';",
        "overflow": "visible",
        "panelupdateOnMount": true,
        "reduceOptions": {
          "calcs": [
            "lastNotNull",
            "last",
            "firstNotNull",
            "first",
            "min",
            "max",
            "mean",
            "sum",
            "count",
            "range",
            "delta",
            "step",
            "diff",
            "logmin",
            "allIsZero",
            "allIsNull",
            "diffperc"
          ]
        },
        "renderOnMount": true,
        "rootCSS": "",
        "useGrafanaScrollbar": true
      },
      "pluginVersion": "2.2.3",
      "targets": [
        {
          "columns": [],
          "datasource": {
            "type": "yesoreyeram-infinity-datasource",
            "uid": "CarConnectivity-live-json-provisioned"
          },
          "filters": [],
          "format": "table",
          "global_query_id": "",
          "parser": "backend",
          "refId": "A",
          "root_selector": "",
          "source": "url",
          "type": "json",
          "url": "/garage/$VIN-car.png.json?fallback=icons/vehicle.png",
          "url_options": {
            "data": "",
            "method": "GET"
          }
        }
      ],
      "title": "$VIN",
      "type": "gapit-htmlgraphics-panel"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "Current state of charge in percent",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "percentage",
            "steps": [
              {
                "color": "red",
                "value": 0
              },
              {
                "color": "yellow",
                "value": 10
              },
              {
                "color": "green",
                "value": 20
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 3,
        "x": 3,
        "y": 0
      },
      "id": 4,
      "options": {
        "minVizHeight": 75,
        "minVizWidth": 75,
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "sizing": "auto",
        "text": {}
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [],
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, level from drive_levels JOIN drives on drive_levels.id == drives.id WHERE drives.vin==\"$VIN\" AND drives.type = \"ELECTRIC\" ORDER BY first_date DESC LIMIT 1",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawQueryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, level from drive_levels JOIN drives on drive_levels.id == drives.id WHERE drives.vin==\"$VIN\" AND drives.type = \"ELECTRIC\" ORDER BY first_date DESC LIMIT 1",
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"level\" AS \"Battery SoC\"\nFROM drive_levels\nLEFT JOIN drives ON drive_levels.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND drives.type = 'ELECTRIC'\nORDER BY \"time\" DESC\nLIMIT 1",
          "refId": "A",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "\"primary_currentSOC_pct\""
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "ranges",
          "tags": [],
          "timeColumn": "\"carCapturedTimestamp\"",
          "timeColumnType": "timestamp",
          "timeColumns": [
            "time",
            "ts"
          ],
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            },
            {
              "datatype": "varchar",
              "name": "",
              "params": [
                "vehicle_vin",
                "=",
                "'$VIN'"
              ],
              "type": "expression"
            }
          ]
        }
      ],
      "title": "Battery (now)",
      "type": "gauge"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "Battery level and projected range plotted over time for primary and secondary engine. This is useful especially for hybrids.\nSome cars only update these values during startup and shutdown.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": true,
            "axisCenteredZero": false,
            "axisColorMode": "series",
            "axisLabel": "Level",
            "axisPlacement": "auto",
            "axisSoftMax": 100,
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": true,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byRegexp",
              "options": "/.*Range/"
            },
            "properties": [
              {
                "id": "unit",
                "value": "lengthkm"
              },
              {
                "id": "custom.axisLabel",
                "value": "Range"
              }
            ]
          },
          {
            "matcher": {
              "id": "byRegexp",
              "options": "/.*Temperature/"
            },
            "properties": [
              {
                "id": "unit",
                "value": "celsius"
              },
              {
                "id": "custom.axisLabel",
                "value": "Temperature"
              },
              {
                "id": "custom.axisSoftMax"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 6,
        "y": 0
      },
      "id": 23,
      "interval": "5m",
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull",
            "max",
            "min"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "editorMode": "code",
          "format": "time_series",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "queryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"\nUNION\nSELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', last_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"",
          "queryType": "table",
          "rawQuery": true,
          "rawQueryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"\nUNION\nSELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', last_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"",
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"range\" AS \"Range\",\n  drives.drive_id as \"Drive\"\nFROM drive_ranges\nLEFT JOIN drives ON drive_ranges.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"range\" AS \"Range\",\n  drives.drive_id as \"Drive\"\nFROM drive_ranges\nLEFT JOIN drives ON drive_ranges.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Range",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "timeColumn": "time",
          "timeColumns": [
            "time",
            "ts"
          ],
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "time_series",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "queryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"\nUNION\nSELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', last_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"",
          "queryType": "table",
          "rawQuery": true,
          "rawQueryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"\nUNION\nSELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', last_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"",
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"level\" AS \"Level\",\n  drives.drive_id as \"Drive\"\nFROM drive_levels\nLEFT JOIN drives ON drive_levels.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"level\" AS \"Level\",\n  drives.drive_id as \"Drive\"\nFROM drive_levels\nLEFT JOIN drives ON drive_levels.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Level",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "timeColumn": "time",
          "timeColumns": [
            "time",
            "ts"
          ],
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "time_series",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "queryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"\nUNION\nSELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', last_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"",
          "queryType": "table",
          "rawQuery": true,
          "rawQueryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"\nUNION\nSELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', last_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"",
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"outside_temperature\" AS \"Outside Temperature\"\nFROM outside_temperatures \nWHERE\n  vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"outside_temperature\" AS \"Outside Temperature\"\nFROM outside_temperatures \nWHERE\n  vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Outside Temperature",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "timeColumn": "time",
          "timeColumns": [
            "time",
            "ts"
          ],
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "time_series",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "queryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"\nUNION\nSELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', last_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"",
          "queryType": "table",
          "rawQuery": true,
          "rawQueryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"\nUNION\nSELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', last_date) as time, range as 'Range', drives.drive_id AS label FROM drive_ranges JOIN drives ON drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\"",
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"battery_temperature\" AS \"Battery Temperature\"\nFROM battery_temperatures \nWHERE\n  vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"battery_temperature\" AS \"Battery Temperature\"\nFROM battery_temperatures \nWHERE\n  vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Battery Temperature",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "timeColumn": "time",
          "timeColumns": [
            "time",
            "ts"
          ],
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Levels & Range",
      "transformations": [
        {
          "id": "prepareTimeSeries",
          "options": {
            "format": "multi"
          }
        }
      ],
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "Indicates if the car is currently awake (online) or sleeping.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [
            {
              "options": {
                "INVALID": {
                  "color": "text",
                  "index": 3,
                  "text": "Car connection status invalid"
                },
                "OFFLINE": {
                  "color": "red",
                  "index": 2,
                  "text": "Car is offline"
                },
                "ONLINE": {
                  "color": "green",
                  "index": 0,
                  "text": "Car is online"
                },
                "REACHABLE": {
                  "color": "orange",
                  "index": 1,
                  "text": "Car is reachable"
                },
                "UNKNOWN": {
                  "color": "text",
                  "index": 4,
                  "text": "Car connection status unknown"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": 0
              }
            ]
          },
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 3,
        "w": 6,
        "x": 18,
        "y": 0
      },
      "id": 22,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "/^connection_state$/",
          "values": true
        },
        "showPercentChange": false,
        "text": {
          "titleSize": 40,
          "valueSize": 40
        },
        "textMode": "value",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "alias": "Car is online",
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [],
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT \"last_date\" AS \"time\", connection_state FROM connection_states WHERE vin = '$VIN' ORDER BY first_date DESC LIMIT 1",
          "refId": "A",
          "resultFormat": "time_series",
          "select": [
            []
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "vehicles",
          "tags": [],
          "timeColumn": "\"lastUpdate\"",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Car Online State",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "Time when the last successful connection to the servers were made and time when the last information from the car was received.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "dateTimeAsIso"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 5,
        "w": 6,
        "x": 18,
        "y": 3
      },
      "id": 13,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "/.*/",
          "values": true
        },
        "showPercentChange": false,
        "text": {},
        "textMode": "value_and_name",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "alias": "Last connection",
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [],
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT \"last_date\" AS \"Last update\" FROM charging_powers WHERE vin = '$VIN'\nUNION\nSELECT \"last_date\" AS \"Last update\" FROM charging_rates WHERE vin = '$VIN'\nUNION\nSELECT \"last_date\" AS \"Last update\" FROM charging_states WHERE vin = '$VIN'\nUNION\nSELECT \"last_date\" AS \"Last update\" FROM climatization_states WHERE vin = '$VIN'\nUNION\nSELECT \"last_date\" AS \"Last update\" FROM connection_states WHERE vin = '$VIN'\nUNION\nSELECT \"last_date\" AS \"Last update\" FROM drive_levels LEFT JOIN drives ON drive_levels.drive_id = drives.id WHERE vin = '$VIN'\nUNION\nSELECT \"last_date\" AS \"Last update\" FROM drive_ranges LEFT JOIN drives ON drive_ranges.drive_id = drives.id WHERE vin = '$VIN'\nUNION\nSELECT \"last_date\" AS \"Last update\" FROM outside_temperatures WHERE vin = '$VIN'\nUNION\nSELECT \"last_date\" AS \"Last update\" FROM states WHERE vin = '$VIN'\nORDER BY \"Last update\" DESC LIMIT 1",
          "refId": "A",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Last Data from Car",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "Current range calculated from current consumption",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "min": 0,
          "thresholds": {
            "mode": "percentage",
            "steps": [
              {
                "color": "red",
                "value": 0
              },
              {
                "color": "#EAB839",
                "value": 10
              },
              {
                "color": "green",
                "value": 20
              }
            ]
          },
          "unit": "lengthkm"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 3,
        "x": 0,
        "y": 8
      },
      "id": 11,
      "options": {
        "minVizHeight": 75,
        "minVizWidth": 75,
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "last"
          ],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "sizing": "auto",
        "text": {}
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [],
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, range from drive_ranges JOIN drives on drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\" AND drives.type = \"ELECTRIC\" ORDER BY first_date DESC LIMIT 1",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawQueryText": "SELECT STRFTIME('%Y-%m-%dT%H:%M:%SZ', first_date) as time, range from drive_ranges JOIN drives on drive_ranges.id == drives.id WHERE drives.vin==\"$VIN\" AND drives.type = \"ELECTRIC\" ORDER BY first_date DESC LIMIT 1",
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"range\" AS \"Electric Range\"\nFROM drive_ranges\nLEFT JOIN drives ON drive_ranges.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND drives.type = 'ELECTRIC'\nORDER BY \"time\" DESC\nLIMIT 1",
          "refId": "A",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "\"totalRange_km\""
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "ranges",
          "tags": [],
          "timeColumn": "\"carCapturedTimestamp\"",
          "timeColumnType": "timestamp",
          "timeColumns": [
            "time",
            "ts"
          ],
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            },
            {
              "datatype": "varchar",
              "name": "",
              "params": [
                "vehicle_vin",
                "=",
                "'$VIN'"
              ],
              "type": "expression"
            }
          ]
        }
      ],
      "title": "Projected Electric Range (now)",
      "transformations": [
        {
          "id": "configFromData",
          "options": {
            "applyTo": {
              "id": "byName"
            },
            "configRefId": "A",
            "mappings": [
              {
                "fieldName": "range",
                "handlerKey": "unit"
              }
            ]
          }
        }
      ],
      "type": "gauge"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "If the car is charging, current charging power. This value is not available on all cars.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "#EAB839",
                "value": 11
              }
            ]
          },
          "unit": "kwatt"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 3,
        "x": 3,
        "y": 8
      },
      "id": 9,
      "options": {
        "minVizHeight": 75,
        "minVizWidth": 75,
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "sizing": "auto",
        "text": {}
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [],
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"power\" AS \"Power\"\nFROM charging_powers\nWHERE\n  vin = '$VIN'\nORDER BY \"time\" DESC\nLIMIT 1",
          "refId": "A",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Charging Power (now)",
      "type": "gauge"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "Current consumption and Range if the car would be at 100% SoC. Consumption is calculated as capacity divided by current range. The green area shows the WLTP range.\nSome cars only update these values during startup and shutdown. Value is only useful for electric cars or hybrids running on electricity only.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "series",
            "axisLabel": "Extrapolated range at 100% SoC",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": true,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "km"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Electric Consumption"
            },
            "properties": [
              {
                "id": "unit",
                "value": "kWh/100km"
              },
              {
                "id": "custom.axisLabel",
                "value": "Calculated consumption"
              },
              {
                "id": "decimals",
                "value": 2
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "WLTP"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#73BF69",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.fillOpacity",
                "value": 20
              },
              {
                "id": "custom.lineWidth",
                "value": 0
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Fuel Consumption"
            },
            "properties": [
              {
                "id": "unit",
                "value": "L/100km"
              },
              {
                "id": "custom.axisLabel",
                "value": "Calculated consumption"
              },
              {
                "id": "decimals",
                "value": 2
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 6,
        "y": 8
      },
      "id": 14,
      "interval": "5m",
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull",
            "max",
            "min"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "alias": "Extrapolated range at 100% SoC",
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [
            {
              "params": [
                "$__interval"
              ],
              "type": "time"
            },
            {
              "params": [
                "previous"
              ],
              "type": "fill"
            }
          ],
          "hide": false,
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"range_estimated_full\" AS \"Range at 100%\",\n  drives.drive_id as \"Drive\"\nFROM drive_ranges_estimated_full\nLEFT JOIN drives ON drive_ranges_estimated_full.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"range_estimated_full\" AS \"Range at 100%\",\n  drives.drive_id as \"Drive\"\nFROM drive_ranges_estimated_full\nLEFT JOIN drives ON drive_ranges_estimated_full.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Range at 100",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              },
              {
                "params": [],
                "type": "mean"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "alias": "Extrapolated range at 100% SoC",
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [
            {
              "params": [
                "$__interval"
              ],
              "type": "time"
            },
            {
              "params": [
                "previous"
              ],
              "type": "fill"
            }
          ],
          "hide": false,
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"consumption\" AS \"Electric Consumption\",\n  drives.drive_id as \"Drive\"\nFROM drive_consumptions \nLEFT JOIN drives ON drive_consumptions.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND drives.type = 'ELECTRIC'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"consumption\" AS \"Electric Consumption\",\n  drives.drive_id as \"Drive\"\nFROM drive_consumptions\nLEFT JOIN drives ON drive_consumptions.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND drives.type = 'ELECTRIC'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Electric Consumption",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              },
              {
                "params": [],
                "type": "mean"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "alias": "Extrapolated range at 100% SoC",
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [
            {
              "params": [
                "$__interval"
              ],
              "type": "time"
            },
            {
              "params": [
                "previous"
              ],
              "type": "fill"
            }
          ],
          "hide": false,
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"consumption\" AS \"Fuel Consumption\",\n  drives.drive_id as \"Drive\"\nFROM drive_consumptions \nLEFT JOIN drives ON drive_consumptions.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND drives.type IN ('FUEL', 'GASOLINE', 'PETROL', 'DIESEL', 'CNG', 'LPG')\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"consumption\" AS \"Fuel Consumption\",\n  drives.drive_id as \"Drive\"\nFROM drive_consumptions\nLEFT JOIN drives ON drive_consumptions.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND drives.type IN ('FUEL', 'GASOLINE', 'PETROL', 'DIESEL', 'CNG', 'LPG')\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Fuel Consumption",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              },
              {
                "params": [],
                "type": "mean"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "alias": "Extrapolated range at 100% SoC",
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [
            {
              "params": [
                "$__interval"
              ],
              "type": "time"
            },
            {
              "params": [
                "previous"
              ],
              "type": "fill"
            }
          ],
          "hide": false,
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\n  unnest(ARRAY[to_timestamp(${__from}/1000), to_timestamp(${__to}/1000)]) AS time,\n  wltp_range as \"WLTP\",\n  drive_id as \"Drive\"\nFROM\n  drives\nWHERE\n  drives.vin = '$VIN'\n  AND wltp_range IS NOT NULL\nORDER BY 1",
          "refId": "B",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              },
              {
                "params": [],
                "type": "mean"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Consumption & Range extrapolated to 100% SoC",
      "transformations": [
        {
          "id": "prepareTimeSeries",
          "options": {
            "format": "multi"
          }
        }
      ],
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "Shows information for the usage of VWsFriend",
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 16,
        "w": 6,
        "x": 18,
        "y": 8
      },
      "id": 25,
      "options": {
        "SVGBaseFix": false,
        "add100Percentage": true,
        "calcsMutation": "none",
        "centerAlignContent": false,
        "codeData": "{\n  \"text\": \"Random text\"\n}",
        "css": "",
        "dynamicData": false,
        "dynamicFieldDisplayValues": false,
        "dynamicHtmlGraphics": true,
        "dynamicProps": false,
        "html": "<div>\n  <div id=\"warningsDiv\" style=\"display: none;\">\n    <h2>Warnings:</h2>\n    <ul id=\"warningsList\">\n    <ul>\n  </div>\n\n  <div id=\"newsDiv\" style=\"display: none;\">\n    <h2>News:</h2>\n  </div>\n\n  <div id=\"logDiv\" style=\"display: none;\">\n    <h2>Recent Events:</h2>\n    <ul id=\"logsList\" style=\"list-style-type:none\">\n    <ul>\n  </div>\n</div>",
        "onInit": "",
        "onInitOnResize": false,
        "onRender": "const warningsDiv = htmlNode.getElementById('warningsDiv');\nconst warningsList = htmlNode.getElementById('warningsList');\nwarningsDiv.style.display = 'none'\nwhile (warningsList.firstChild) {\n    warningsList.firstChild.remove()\n}\nconst logsDiv = htmlNode.getElementById('logDiv');\nconst logsList = htmlNode.getElementById('logsList');\nlogsDiv.style.display = 'none'\nwhile (logsList.firstChild) {\n    logsList.firstChild.remove()\n}\n\nfunction addWarning(html) {\n  warningsDiv.style.display = ''\n  warning = document.createElement(\"li\")\n  warning.style.color = 'yellow'\n  var template = document.createElement('template');\n  html = html.trim();\n  template.innerHTML = html;\n  warning.append(template.content);\n  warningsList.appendChild(warning)\n}\n\nfunction addLog(html) {\n  logsDiv.style.display = ''\n  log = document.createElement(\"li\")\n  var template = document.createElement('template');\n  html = html.trim();\n  template.innerHTML = html;\n  log.append(template.content);\n  logsList.appendChild(log)\n}\n\nfunction getMetric(seriesName, metricName) {\n  const filteredSeries = data.series.filter((series) => series.refId == seriesName);\n  if(filteredSeries.length > 0 && filteredSeries[0].fields != null\n        && filteredSeries[0].fields.length > 0){\n    const filteredFields = filteredSeries[0].fields.filter((fields) => fields.name == metricName)\n    if(filteredFields.length > 0){\n      return filteredFields[0].values.get(0)\n    }\n  }\n  return null\n}\n\nconst carconnectivity_url = getTemplateSrv().replace(`$carconnectivity_url`);\nconst vin = getTemplateSrv().replace(`$VIN`);\nif(carconnectivity_url == null || carconnectivity_url== ''){\n  addWarning(\"You have to set the URL for the VWsFriend user interface correctly: Go to the user interface on port 4000 and select \\\"Database\\\" > \\”Connection Settings\\\"\")\n}\n\nconst carType = getMetric('vehicle_drives', 'type')\nconst nickname = getMetric('vehicle_drives', 'name')\nconst primaryCapacity = getMetric('vehicle_drives', 'capacity')\nconst primaryCapacityTotal = getMetric('vehicle_drives', 'capacity_total')\n//const secondaryCapacity = getMetric('vehicle_drives', 'secondary_capacity')\n//const secondaryCapacityTotal = getMetric('vehicle_drives', 'secondary_capacity_total')\n//const timezone = getMetric('vehicle_drives', 'timezone')\n\nif(carType == null){\n  addWarning(\"The car type type of \"+nickname+\" could not be detected yet.\")\n}\nelse{\n  switch (carType) {\n    case 'FUEL':\n    case 'GASOLINE':\n    case 'PETROL':\n    case 'DIESEL':\n    case 'CNG':\n    case 'LPG':\n      if(primaryCapacity == null){\n        addWarning(\"Some panels need the tank size of \"+nickname+\" to be set.\")\n      }\n    case 'HYBRID':\n      if(primaryCapacity == null || primaryCapacityTotal == null){\n        addWarning(\"Some panels need the battery capacity of \"+nickname+\" to be set.\")\n      }\n      if(secondaryCapacity == null || secondaryCapacityTotal == null){\n        addWarning(\"Some panels need the battery capacity of \"+nickname+\" to be set.\")\n      }\n    \n      break;\n    case 'ELECTRIC':\n      if(primaryCapacity == null){\n        addWarning(\"Some panels need the battery capacity of \"+nickname+\" to be set.\")\n      }\n      break;\n  }\n}\n//if(timezone == null){\n//  addWarning(\"Some panels need the timezone of \"+nickname+\" to be set. Please set the timezone here: <a href=\\\"\"+carconnectivity_url+\"/settings/vehicle/database/\"+vin+\"\\\" target=\\”_blank\\”>Vehicle Parameters</a>\")\n//}\n\n//Log\nconst filteredSeries = data.series.filter((series) => series.refId == 'log');\n  if(filteredSeries.length > 0 && filteredSeries[0].fields != null\n        && filteredSeries[0].fields.length > 0){\n    const filteredFields = filteredSeries[0].fields.filter((fields) => (fields.name == 'logtime' || fields.name == 'log'))\n    timeZone = htmlGraphics.props.timeZone;\n    if(filteredFields.length == 2){\n      time = filteredFields[0];\n      logstring = filteredFields[1];\n      var options = { dateStyle: 'short' };\n      if(timeZone!='browser'){\n        options.timeZone = timeZone;\n      }\n      var timeOptions = { timeStyle: 'short' };\n      if(timeZone!='browser'){\n        timeOptions.timeZone = timeZone;\n      }\n      var beforedate = new Intl.DateTimeFormat('default', options).format(new Date());\n      for(let i = 0; i < time.values.length; i++) {\n        var date = new Intl.DateTimeFormat('default', options).format(new Date(time.values.get(i)));\n        if(beforedate != date){\n          addLog('<b>'+date+'</b>');\n        }\n        beforedate = date;\n        var timestr = new Intl.DateTimeFormat('default', timeOptions).format(new Date(time.values.get(i)));\n        addLog(timestr+\": \"+logstring.values.get(i));\n      }\n    }\n  }",
        "overflow": "auto",
        "panelupdateOnMount": true,
        "reduceOptions": {
          "calcs": []
        },
        "renderOnMount": true,
        "rootCSS": "",
        "useGrafanaScrollbar": true
      },
      "pluginVersion": "2.2.3",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  drives.*,\n  vehicles.name,\n  vehicles.type AS vehicle_type\nFROM drives\nLEFT JOIN vehicles ON drives.vin = vehicles.vin\nWHERE\n  vehicles.vin = '${VIN}'\nORDER BY 1",
          "refId": "vehicle_drives",
          "select": [
            [
              {
                "params": [
                  "\"maximumChargePower_kW\""
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "settings",
          "timeColumn": "connected",
          "timeColumnType": "timestamp",
          "where": []
        },
        {
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "hide": false,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  logtime,\n  log FROM\n(\n  (SELECT\n    session_start_date AS logtime,\n    'charging started' AS log\n  FROM charging_sessions\n  WHERE session_start_date IS NOT NULL AND vin = '${VIN}'\n  ORDER BY session_start_date DESC\n  LIMIT 3)\n  UNION\n  (SELECT\n    plug_connected_date AS logtime,\n    'charging cable connected' AS log\n  FROM charging_sessions\n  WHERE plug_connected_date IS NOT NULL AND vin = '${VIN}'\n  ORDER BY plug_connected_date DESC\n  LIMIT 3)\n  UNION\n  (SELECT\n    plug_locked_date AS logtime,\n    'charging connector locked' AS log\n  FROM charging_sessions\n  WHERE plug_locked_date IS NOT NULL AND vin = '${VIN}'\n  ORDER BY plug_locked_date DESC\n  LIMIT 3)\n  UNION\n    (SELECT\n    session_end_date AS logtime,\n    'charging ended' AS log\n  FROM charging_sessions\n  WHERE session_end_date IS NOT NULL AND vin = '${VIN}'\n  ORDER BY session_end_date DESC\n  LIMIT 3)\n  UNION\n  (SELECT\n    plug_disconnected_date AS logtime,\n    'charging cable disconnected' AS log\n  FROM charging_sessions\n  WHERE plug_disconnected_date IS NOT NULL AND vin = '${VIN}'\n  ORDER BY plug_disconnected_date DESC\n  LIMIT 3)\n  UNION\n  (SELECT\n    plug_unlocked_date AS logtime,\n    'charging connector unlocked' AS log\n  FROM charging_sessions\n  WHERE plug_unlocked_date IS NOT NULL AND vin = '${VIN}'\n  ORDER BY plug_unlocked_date DESC\n  LIMIT 3)\n   UNION\n  (SELECT\n    \"start_date\" AS logtime,\n    'trip started' AS log\n  FROM trips\n  WHERE \"start_date\" IS NOT NULL AND vin = '${VIN}'\n  ORDER BY \"start_date\" DESC\n  LIMIT 10)\n  UNION\n  (SELECT\n    \"destination_date\" AS logtime,\n    'trip ended' AS log\n  FROM trips\n  WHERE \"destination_date\" IS NOT NULL AND vin = '${VIN}'\n  ORDER BY \"destination_date\" DESC\n  LIMIT 10)\n  UNION\n  (SELECT\n  \"first_date\" AS logtime,\n  CASE WHEN \"state\"= 'OFF' THEN 'climatisation stopped'\n       WHEN \"state\"= 'HEATING' THEN 'climatisation heating'\n       WHEN \"state\"= 'COOLING' THEN 'climatisation cooling'\n       WHEN \"state\"= 'VENTILATION' THEN 'climatisation ventilating'\n       ELSE 'unkown'\n  END AS log\n  FROM climatization_states\n  WHERE \"first_date\" IS NOT NULL AND vin = '${VIN}'\n  ORDER BY \"first_date\" DESC\n  LIMIT 10)\n  UNION\n  (SELECT\n    session_date AS logtime,\n    'car was refueled' AS log\n  FROM refuel_sessions\n  WHERE session_date IS NOT NULL AND vin = '${VIN}'\n  ORDER BY session_date DESC\n  LIMIT 3)\n) AS logs\nORDER BY 1 DESC\nLIMIT 20",
          "refId": "log",
          "select": [
            [
              {
                "params": [
                  "\"maximumChargePower_kW\""
                ],
                "type": "column"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "table": "settings",
          "timeColumn": "connected",
          "timeColumnType": "timestamp",
          "where": []
        },
        {
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "format": "table",
          "group": [],
          "hide": true,
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT\n  COUNT(*)>2 AS has_error\nFROM weconnect_errors\nWHERE datetime > (NOW() - INTERVAL '30 MINUTES')",
          "refId": "error",
          "select": [
            [
              {
                "params": [
                  "\"maximumChargePower_kW\""
                ],
                "type": "column"
              }
            ]
          ],
          "table": "settings",
          "timeColumn": "connected",
          "timeColumnType": "timestamp",
          "where": []
        }
      ],
      "title": "Information",
      "type": "gapit-htmlgraphics-panel"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "Current efficiency. 100% means that with the current consumption the WLTP range is reached.\nSome cars only update these values during startup and shutdown. Value is only useful for electric cars or hybrids running on electricity only.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Efficiency",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "stepAfter",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": true,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Temperature"
            },
            "properties": [
              {
                "id": "unit",
                "value": "celsius"
              },
              {
                "id": "min",
                "value": -15
              },
              {
                "id": "max",
                "value": 40
              },
              {
                "id": "custom.axisPlacement",
                "value": "hidden"
              },
              {
                "id": "custom.axisLabel",
                "value": "Temperature"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "100% = WLTP Range"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#c9c9c9",
                  "mode": "fixed"
                }
              },
              {
                "id": "custom.fillOpacity",
                "value": 0
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 6,
        "y": 16
      },
      "id": 15,
      "interval": "5m",
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull",
            "max",
            "min"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "alias": "Efficiency (Compared to WLTP range)",
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [
            {
              "params": [
                "$__interval"
              ],
              "type": "time"
            },
            {
              "params": [
                "previous"
              ],
              "type": "fill"
            }
          ],
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"range_estimated_full\"/\"wltp_range\"*100 AS \"Efficiency\",\n  drives.drive_id as \"Drive\"\nFROM drive_ranges_estimated_full\nLEFT JOIN drives ON drive_ranges_estimated_full.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\n  AND wltp_range IS NOT NULL\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"range_estimated_full\"/\"wltp_range\"*100 AS \"Efficiency\",\n  drives.drive_id as \"Drive\"\nFROM drive_ranges_estimated_full\nLEFT JOIN drives ON drive_ranges_estimated_full.drive_id = drives.id\nWHERE\n  drives.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\n  AND wltp_range IS NOT NULL\nORDER BY \"time\" ASC",
          "refId": "Efficiency",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              },
              {
                "params": [],
                "type": "mean"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "alias": "Efficiency (Compared to WLTP range)",
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "time_series",
          "group": [],
          "groupBy": [
            {
              "params": [
                "$__interval"
              ],
              "type": "time"
            },
            {
              "params": [
                "previous"
              ],
              "type": "fill"
            }
          ],
          "hide": false,
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\n  unnest(ARRAY[to_timestamp(${__from}/1000), to_timestamp(${__to}/1000)]) AS time,\n  100 AS \"100% = WLTP Range\"\nFROM\n  drives\nWHERE\n  drives.vin = '$VIN'\n  AND wltp_range IS NOT NULL\nORDER BY 1",
          "refId": "WLTP",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              },
              {
                "params": [],
                "type": "mean"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Efficiency",
      "transformations": [
        {
          "id": "prepareTimeSeries",
          "options": {
            "format": "multi"
          }
        }
      ],
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "Charging power and charging rate in kilometers over time.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": true,
            "axisCenteredZero": false,
            "axisColorMode": "series",
            "axisLabel": "Charging Power",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": true,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "kwatt"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Charging Rate"
            },
            "properties": [
              {
                "id": "unit",
                "value": "velocitykmh"
              },
              {
                "id": "custom.axisLabel",
                "value": "Charging Rate"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Outside Temperature"
            },
            "properties": [
              {
                "id": "unit",
                "value": "celsius"
              },
              {
                "id": "custom.axisLabel",
                "value": "Temperature"
              },
              {
                "id": "decimals",
                "value": 1
              },
              {
                "id": "custom.axisPlacement",
                "value": "right"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 6,
        "y": 24
      },
      "id": 18,
      "interval": "5m",
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull",
            "max",
            "min"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "alias": "Charge Power",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [
            {
              "params": [
                "$__interval"
              ],
              "type": "time"
            },
            {
              "params": [
                "previous"
              ],
              "type": "fill"
            }
          ],
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\r\n  \"first_date\" AS \"time\",\r\n  \"power\" AS \"Charging Power\"\r\nFROM charging_powers \r\nWHERE\r\n  vin = '$VIN'\r\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\r\nUNION\r\nSELECT\r\n  \"last_date\" AS \"time\",\r\n  \"power\" AS \"Charging Power\"\r\nFROM charging_powers\r\nWHERE\r\n  vin = '$VIN'\r\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\r\nORDER BY \"time\" ASC",
          "refId": "Power",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              },
              {
                "params": [],
                "type": "mean"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "alias": "Charge Power",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [
            {
              "params": [
                "$__interval"
              ],
              "type": "time"
            },
            {
              "params": [
                "previous"
              ],
              "type": "fill"
            }
          ],
          "hide": false,
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\r\n  \"first_date\" AS \"time\",\r\n  \"rate\" AS \"Charging Rate\"\r\nFROM charging_rates\r\nWHERE\r\n  vin = '$VIN'\r\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\r\nUNION\r\nSELECT\r\n  \"last_date\" AS \"time\",\r\n  \"rate\" AS \"Charging Rate\"\r\nFROM charging_rates \r\nWHERE\r\n  vin = '$VIN'\r\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\r\nORDER BY \"time\" ASC",
          "refId": "Rate",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              },
              {
                "params": [],
                "type": "mean"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "alias": "Charge Power",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [
            {
              "params": [
                "$__interval"
              ],
              "type": "time"
            },
            {
              "params": [
                "previous"
              ],
              "type": "fill"
            }
          ],
          "hide": false,
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\r\n  \"first_date\" AS \"time\",\r\n  \"outside_temperature\" AS \"Outside Temperature\"\r\nFROM outside_temperatures \r\nWHERE\r\n  vin = '$VIN'\r\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\r\nUNION\r\nSELECT\r\n  \"last_date\" AS \"time\",\r\n  \"outside_temperature\" AS \"Outside Temperature\"\r\nFROM outside_temperatures \r\nWHERE\r\n  vin = '$VIN'\r\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\r\nORDER BY \"time\" ASC",
          "refId": "Outside Temperature",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              },
              {
                "params": [],
                "type": "mean"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "hide": true,
          "rawQuery": true,
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"battery_temperature\" AS \"Battery Temperature\"\nFROM battery_temperatures \nWHERE\n  vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"battery_temperature\" AS \"Battery Temperature\"\nFROM battery_temperatures \nWHERE\n  vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Battery Temperature",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Charging",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 2,
        "w": 6,
        "x": 18,
        "y": 24
      },
      "id": 27,
      "links": [
        {
          "targetBlank": true,
          "title": "CarConnectivity on GitHub",
          "url": "https://github.com/tillsteinbach/CarConnectivity/"
        }
      ],
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "CarConnectivity Grafana version: [0.0.0dev](https://github.com/tillsteinbach/CarConnectivity-grafana/)",
        "mode": "markdown"
      },
      "pluginVersion": "12.3.1",
      "title": "Version",
      "type": "text"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "CarConnectivity-PostgreSQL-provisioned"
      },
      "description": "Highlights the times when the car is online, heating and charging.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "fixed"
          },
          "custom": {
            "axisPlacement": "auto",
            "fillOpacity": 70,
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineWidth": 0,
            "spanNulls": false
          },
          "mappings": [
            {
              "options": {
                "CHARGE_PURPOSE_REACHED_CONSERVATION": {
                  "color": "blue",
                  "index": 15,
                  "text": "conservation charging"
                },
                "CHARGE_PURPOSE_REACHED_NOT_CONSERVATION_CHARGING": {
                  "color": "green",
                  "index": 14,
                  "text": "charge purpose reached"
                },
                "CHARGING": {
                  "color": "blue",
                  "index": 13,
                  "text": "charging"
                },
                "CONSERVATION": {
                  "color": "blue",
                  "index": 17,
                  "text": "conservation"
                },
                "COOLING": {
                  "color": "blue",
                  "index": 9,
                  "text": "cooling"
                },
                "DISCHARGING": {
                  "color": "yellow",
                  "index": 20,
                  "text": "discharging"
                },
                "DRIVING": {
                  "color": "green",
                  "index": 1,
                  "text": "driving"
                },
                "ERROR": {
                  "color": "red",
                  "index": 12,
                  "text": "error"
                },
                "HEATING": {
                  "color": "red",
                  "index": 7,
                  "text": "heating"
                },
                "IGNITION_ON": {
                  "color": "green",
                  "index": 0,
                  "text": "ignition_on"
                },
                "INVALID": {
                  "color": "red",
                  "index": 16,
                  "text": "invalid"
                },
                "NOT_READY_FOR_CHARGING": {
                  "color": "#3d3d3d",
                  "index": 18,
                  "text": "not ready for charging"
                },
                "OFF": {
                  "color": "#3d3d3d",
                  "index": 6,
                  "text": "off"
                },
                "OFFLINE": {
                  "color": "#3d3d3d",
                  "index": 4,
                  "text": "offline"
                },
                "ON": {
                  "color": "green",
                  "index": 8,
                  "text": "on"
                },
                "ONLINE": {
                  "color": "green",
                  "index": 3,
                  "text": "online"
                },
                "PARKED": {
                  "color": "blue",
                  "index": 2,
                  "text": "parked"
                },
                "REACHABLE": {
                  "color": "blue",
                  "index": 5,
                  "text": "reachable"
                },
                "READY_FOR_CHARGING": {
                  "color": "green",
                  "index": 11,
                  "text": "ready for charging"
                },
                "UNSUPPORTED": {
                  "color": "#3d3d3d",
                  "index": 19,
                  "text": "unsupported"
                },
                "VENTILATION": {
                  "color": "purple",
                  "index": 10,
                  "text": "ventilation"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 12,
        "x": 6,
        "y": 32
      },
      "id": 21,
      "interval": "5m",
      "options": {
        "alignValue": "center",
        "legend": {
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": false
        },
        "mergeValues": true,
        "rowHeight": 0.9,
        "showValue": "auto",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "alias": "Car state",
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [],
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"state\" AS \"Vehicle State\"\nFROM states\nWHERE\n  states.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"state\" AS \"Vehicle State\"\nFROM states\nWHERE\n  states.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Vehicle State",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "alias": "Car state",
          "datasource": {
            "type": "postgres",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "group": [],
          "groupBy": [],
          "hide": false,
          "measurement": "",
          "metricColumn": "none",
          "orderByTime": "ASC",
          "policy": "default",
          "query": "",
          "queryType": "randomWalk",
          "rawQuery": true,
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"connection_state\" AS \"Connection\"\nFROM connection_states\nWHERE\n  connection_states.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"connection_state\" AS \"Connection\"\nFROM connection_states\nWHERE\n  connection_states.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Connection State",
          "resultFormat": "time_series",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "field"
              }
            ]
          ],
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          },
          "tags": [],
          "timeColumn": "time",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        },
        {
          "dataset": "carconnectivity",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "hide": false,
          "rawQuery": true,
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"state\" AS \"Charging\"\nFROM charging_states\nWHERE\n  charging_states.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"state\" AS \"Connection\"\nFROM charging_states\nWHERE\n  charging_states.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "Charging State",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        },
        {
          "dataset": "carconnectivity",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "CarConnectivity-PostgreSQL-provisioned"
          },
          "editorMode": "code",
          "format": "table",
          "hide": false,
          "rawQuery": true,
          "rawSql": "SELECT\n  \"first_date\" AS \"time\",\n  \"state\" AS \"Climatizaton\"\nFROM climatization_states\nWHERE\n  climatization_states.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nUNION\nSELECT\n  \"last_date\" AS \"time\",\n  \"state\" AS \"Climatizaton\"\nFROM climatization_states\nWHERE\n  climatization_states.vin = '$VIN'\n  AND ($__timeFilter(\"first_date\") OR $__timeFilter(\"last_date\"))\nORDER BY \"time\" ASC",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "States",
      "type": "state-timeline"
    }
  ],
  "preload": false,
  "refresh": "1m",
  "schemaVersion": 42,
  "tags": [
    "carconnectivity"
  ],
  "templating": {
    "list": [
      {
        "datasource": {
          "type": "postgres",
          "uid": "CarConnectivity-PostgreSQL-provisioned"
        },
        "definition": "SELECT \"vin\" || ':' || \"name\" || ' (' || \"model\" || ' - ' || \"type\" || ')' FROM vehicles",
        "description": "Select Car if you have multiple cars in your account",
        "includeAll": false,
        "label": "Car",
        "name": "VIN",
        "options": [],
        "query": "SELECT \"vin\" || ':' || \"name\" || ' (' || \"model\" || ' - ' || \"type\" || ')' FROM vehicles",
        "refresh": 1,
        "regex": "/(?<value>[A-Z0-9]+):(?<text>.*)/",
        "type": "query"
      },
      {
        "allowCustomValue": false,
        "datasource": {
          "type": "marcusolsson-json-datasource",
          "uid": "CarConnectivity-Env-json-provisioned"
        },
        "definition": "",
        "hide": 2,
        "name": "carconnectivity_url",
        "options": [],
        "query": {
          "cacheDurationSeconds": 86400,
          "fields": [
            {
              "jsonPath": "$.carconnectivity_ui_url"
            }
          ],
          "method": "GET",
          "queryParams": "",
          "urlPath": ""
        },
        "refresh": 1,
        "regex": "",
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Car Overview",
  "uid": "overview",
  "version": 1
}